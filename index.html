<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Judoka</title>

  <style>
    :root{
      --bg:#0b0b0f;
      --stroke:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --r:22px;

      --ok: rgba(52,199,89,1);     /* iOS green */
      --warn: rgba(255,204,0,1);   /* iOS yellow */
      --bad: rgba(255,59,48,1);    /* iOS red */
      --blue: rgba(10,132,255,1);  /* iOS blue */
      --pink: rgba(255,45,85,1);

      --glass1: rgba(255,255,255,.14);
      --glass2: rgba(255,255,255,.08);
      --sep: rgba(255,255,255,.10);
      --chip: rgba(0,0,0,.16);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; padding:20px;
      display:flex; justify-content:center; align-items:center;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Segoe UI",Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 12% 8%, rgba(120,80,255,.44), transparent 60%),
        radial-gradient(900px 700px at 88% 16%, rgba(0,200,255,.34), transparent 60%),
        radial-gradient(900px 700px at 40% 92%, rgba(255,80,160,.26), transparent 65%),
        var(--bg);
    }

    .wrap{width:100%;max-width:620px}
    .header{ text-align:center; margin-bottom:14px; }
    .title{ margin:0 0 6px; font-weight:950; letter-spacing:-.03em; font-size:32px; }
    .sub{ margin:0; color:var(--muted); font-size:14px; line-height:1.35; }

    .card{
      border-radius:var(--r);
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, var(--glass1), var(--glass2));
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    /* ===== BIG FUN PROGRESS (with steps) ===== */
    .progressWrap{
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.08);
    }

    .stepsRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }

    .s{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
      flex:1;
    }

    .bubble{
      width:30px;height:30px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      font-size:13px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.16);
      box-shadow:0 12px 28px rgba(0,0,0,.25);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
      flex:0 0 auto;
    }
    .s.active .bubble{
      border-color:rgba(10,132,255,.5);
      box-shadow:0 0 0 7px rgba(10,132,255,.14), 0 16px 34px rgba(0,0,0,.30);
      transform:scale(1.05);
    }
    .s.done .bubble{
      border-color:rgba(52,199,89,.50);
      box-shadow:0 0 0 7px rgba(52,199,89,.12), 0 16px 34px rgba(0,0,0,.28);
    }
    .s.done .bubble::after{
      content:"‚úì";
      font-size:13px;
      font-weight:1000;
    }
    .s.done .bubble span{ display:none; }

    .lbl{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .lbl strong{
      font-size:12px;
      letter-spacing:-.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .lbl em{
      font-style:normal;
      font-size:11px;
      color:rgba(255,255,255,.60);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .bar{
      height:12px;
      border-radius:999px;
      background:rgba(255,255,255,.07);
      overflow:hidden;
      position:relative;
      border:1px solid rgba(255,255,255,.10);
    }
    .bar > div{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(10,132,255,.95), rgba(88,86,214,.95), rgba(255,45,85,.92));
      transition:width .28s ease;
      position:relative;
    }
    .bar > div::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(90deg, rgba(255,255,255,.0), rgba(255,255,255,.14), rgba(255,255,255,.0));
      transform:translateX(-40%);
      animation: shine 1.6s linear infinite;
      opacity:.9;
    }
    @keyframes shine{
      to{ transform:translateX(40%); }
    }

    .sec{ padding:18px; }

    /* ===== Apple-ish "sheet" ===== */
    .sheet{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.14);
      border-radius:20px;
      overflow:hidden;
    }

    .sheetTop{
      padding:14px 14px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .kicker{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }

    .badge{
      width:30px;height:30px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      color:rgba(255,255,255,.9);
      font-weight:900;
      font-size:13px;
      box-shadow:0 12px 28px rgba(0,0,0,.25);
      flex:0 0 auto;
    }

    .titles{ min-width:0; }
    .stepTitle{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:-.02em;
      line-height:1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .stepSub{
      margin:6px 0 0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    .status{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:var(--chip);
      color:rgba(255,255,255,.86);
      font-size:12px;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .status .dot{
      width:8px;height:8px;border-radius:999px;
      background:var(--warn);
      box-shadow:0 0 0 3px rgba(255,204,0,.16);
    }
    .status.ok .dot{
      background:var(--ok);
      box-shadow:0 0 0 3px rgba(52,199,89,.16);
    }

    .divider{ height:1px; background:var(--sep); }

    /* Animated field area */
    .fieldArea{
      padding:14px;
      overflow:hidden;
    }
    .stage{
      display:grid;
      gap:10px;
      transition:opacity .22s ease, transform .26s ease;
      opacity:1;
      transform:translateY(0);
    }
    .fieldArea.hiding .stage{
      opacity:0;
      transform:translateY(-10px);
      pointer-events:none;
    }

    .field{ position:relative; }
    input, select{
      width:100%;
      padding:14px 44px 14px 14px;
      font-size:16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);
      color:var(--text);
      outline:none;
      -webkit-appearance:none;
      appearance:none;
      transition:border-color .2s ease, box-shadow .2s ease;
    }
    input:focus, select:focus{
      border-color:rgba(10,132,255,.55);
      box-shadow:0 0 0 6px rgba(10,132,255,.14);
    }
    input::placeholder{ color:rgba(255,255,255,.28); }

    .is-empty{
      border-color:rgba(255,204,0,.42) !important;
      box-shadow:0 0 0 6px rgba(255,204,0,.10);
    }
    .is-ok{
      border-color:rgba(52,199,89,.42) !important;
      box-shadow:0 0 0 6px rgba(52,199,89,.12);
    }

    .check{
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%) scale(.92);
      width:24px;height:24px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.16);
      color:rgba(255,255,255,.9);
      font-size:14px;
      opacity:0;
      transition:opacity .18s ease, transform .18s ease;
      pointer-events:none;
    }
    .check.show{
      opacity:1;
      transform:translateY(-50%) scale(1);
      border-color:rgba(52,199,89,.42);
      box-shadow:0 0 0 6px rgba(52,199,89,.10);
    }

    .nav{
      display:flex;
      gap:10px;
      padding:14px;
      border-top:1px solid var(--sep);
      background:rgba(0,0,0,.08);
    }
    .btn{
      flex:1;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.16);
      color:rgba(255,255,255,.92);
      font-size:15px;
      font-weight:800;
      cursor:pointer;
      user-select:none;
      transition:transform .08s ease, box-shadow .16s ease, border-color .16s ease;
    }
    .btn:active{ transform:scale(.99); }
    .btn.primary{
      border-color:rgba(10,132,255,.35);
      box-shadow:0 12px 34px rgba(10,132,255,.08);
    }
    .btn[disabled]{ opacity:.45; cursor:not-allowed; box-shadow:none; }

    /* QR */
    .qrBox{
      padding:16px 18px 18px;
      border-top:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.10);
      text-align:center;
    }
    .tip{
      margin:0 0 10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.14);
      color:rgba(255,255,255,.86);
      font-size:13px;
      line-height:1.35;
    }
    .tip b{ color:rgba(255,255,255,.95); }

    .qrFrame{
      margin:8px auto 0;
      width:min(380px,94%);
      aspect-ratio:1/1;
      border-radius:24px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      position:relative;
    }

    #qr{
      width:100%;height:100%;
      object-fit:contain;
      display:none;
      opacity:0;
      transform:scale(.86);
      filter:drop-shadow(0 16px 40px rgba(0,0,0,.40));
    }
    #qr.reveal{
      display:block;
      animation: reveal .62s cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes reveal{
      0%{opacity:0; transform:scale(.70) rotate(-5deg)}
      58%{opacity:1; transform:scale(1.06) rotate(2deg)}
      100%{opacity:1; transform:scale(1) rotate(0)}
    }

    .spark{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
    }
    .spark.on{ animation:spark .72s ease forwards; }
    @keyframes spark{
      0%{opacity:0; transform:scale(.98)}
      25%{opacity:1}
      100%{opacity:0; transform:scale(1.03)}
    }
    .spark:before,.spark:after{
      content:"‚ú®";
      position:absolute;
      font-size:20px;
      opacity:.92;
      filter:drop-shadow(0 10px 22px rgba(0,0,0,.40));
      animation: floaty .72s ease forwards;
    }
    .spark:before{ left:18px; top:18px; }
    .spark:after{ right:18px; bottom:18px; }
    @keyframes floaty{
      from{ transform:translateY(12px) scale(.9); opacity:0}
      45%{opacity:1}
      to{ transform:translateY(-14px) scale(1.08); opacity:0}
    }

    .hint{margin-top:12px;font-size:13px;color:var(--muted);line-height:1.45}
    .payload{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      text-align:left;
      border:1px dashed rgba(255,255,255,.22);
      background:rgba(0,0,0,.16);
      word-break:break-word;
      font-size:13px;
      color:rgba(255,255,255,.82);
      display:none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1 class="title">üèÜ Pr√©-inscription ü•ã</h1>
      <p class="sub">Remplis les champs, puis r√©cup√®re ton QR.</p>
    </div>

    <div class="card">

      <!-- Big fun progress with steps -->
      <div class="progressWrap">
        <div class="stepsRow" id="stepsRow">
          <div class="s active" data-i="0">
            <div class="bubble"><span>1</span></div>
            <div class="lbl"><strong>Nom</strong><em id="pv-0">‚Ä¶</em></div>
          </div>
          <div class="s" data-i="1">
            <div class="bubble"><span>2</span></div>
            <div class="lbl"><strong>Pr√©nom</strong><em id="pv-1">‚Ä¶</em></div>
          </div>
          <div class="s" data-i="2">
            <div class="bubble"><span>3</span></div>
            <div class="lbl"><strong>Club</strong><em id="pv-2">‚Ä¶</em></div>
          </div>
          <div class="s" data-i="3">
            <div class="bubble"><span>4</span></div>
            <div class="lbl"><strong>Sexe</strong><em id="pv-3">‚Ä¶</em></div>
          </div>
        </div>

        <div class="bar"><div id="progressBar"></div></div>
      </div>

      <div class="sec">
        <div class="sheet">
          <div class="sheetTop">
            <div class="kicker">
              <div class="badge" id="badge">1</div>
              <div class="titles">
                <p class="stepTitle" id="stepTitle">Nom</p>
                <p class="stepSub" id="stepSub">Le nom passe automatiquement en MAJ.</p>
              </div>
            </div>

            <div class="status" id="status">
              <span class="dot"></span><span id="statusTxt">Requis</span>
            </div>
          </div>

          <div class="divider"></div>

          <div class="fieldArea" id="fieldArea">
            <div class="stage" id="stage"></div>
          </div>

          <div class="nav">
            <button class="btn" id="backBtn" disabled>Retour</button>
            <button class="btn primary" id="nextBtn" disabled>Suivant</button>
          </div>
        </div>
      </div>

      <div class="qrBox">
        <p class="tip">Astuce üëâ appui long sur le QR ‚Üí <b>Enregistrer l‚Äôimage</b></p>

        <div class="qrFrame">
          <div class="spark" id="spark"></div>
          <img id="qr" alt="QR Code">
          <div id="empty" class="hint" style="padding:18px;max-width:360px;">
            Le QR appara√Ætra ici √† la fin üéâ
          </div>
        </div>

        <div class="hint" id="hint"></div>
        <div class="payload" id="payload"></div>
      </div>
    </div>
  </div>

  <script>
    class ClubsProvider {
      static list() { return ["Paris","Nice","Lyon","Marseille","Lille","Toulouse","Chambly"]; }
    }

    class QrService {
      static url(payload, size = 560) {
        return "https://api.qrserver.com/v1/create-qr-code/?size="
          + size + "x" + size
          + "&data=" + encodeURIComponent(payload);
      }
    }

    class SoundService {
      static playHajime() {
        try {
          const text = "„ÅØ„Åò„ÇÅ";
          if (!("speechSynthesis" in window)) return;

          const u = new SpeechSynthesisUtterance(text);
          u.lang = "ja-JP";
          u.rate = 0.95;
          u.pitch = 1.05;

          const voices = window.speechSynthesis.getVoices?.() || [];
          const ja = voices.find(v => (v.lang || "").toLowerCase().startsWith("ja"));
          if (ja) u.voice = ja;

          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(u);
        } catch(e) {}
      }
    }

    class App {
      constructor() {
        // progress steps
        this.stepsRow = document.getElementById("stepsRow");
        this.stepNodes = [...document.querySelectorAll(".s[data-i]")];
        this.preview = [
          document.getElementById("pv-0"),
          document.getElementById("pv-1"),
          document.getElementById("pv-2"),
          document.getElementById("pv-3"),
        ];
        this.progressBar = document.getElementById("progressBar");

        // sheet
        this.badge = document.getElementById("badge");
        this.stepTitle = document.getElementById("stepTitle");
        this.stepSub = document.getElementById("stepSub");
        this.status = document.getElementById("status");
        this.statusTxt = document.getElementById("statusTxt");
        this.stage = document.getElementById("stage");
        this.fieldArea = document.getElementById("fieldArea");

        // nav
        this.backBtn = document.getElementById("backBtn");
        this.nextBtn = document.getElementById("nextBtn");

        // QR
        this.qr = document.getElementById("qr");
        this.empty = document.getElementById("empty");
        this.hint = document.getElementById("hint");
        this.payloadBox = document.getElementById("payload");
        this.spark = document.getElementById("spark");

        // state
        this.state = { nom:"", prenom:"", club:"", sexe:"" };
        this.current = 0;
        this.playedSound = false;

        this.steps = [
          {
            key:"nom",
            title:"Nom",
            sub:"Le nom passe automatiquement en MAJ.",
            render: () => this.renderInput("nom", "JORDAN", "family-name"),
            normalize: (v)=> String(v||"").toUpperCase(),
            preview: (v)=> v ? v : "‚Ä¶",
          },
          {
            key:"prenom",
            title:"Pr√©nom",
            sub:"Premi√®re lettre automatiquement en majuscule.",
            render: () => this.renderInput("prenom", "Mickael", "given-name"),
            normalize: (v)=> {
              v = String(v||"").trim();
              if (!v) return "";
              return v.charAt(0).toUpperCase() + v.slice(1);
            },
            preview: (v)=> v ? v : "‚Ä¶",
          },
          {
            key:"club",
            title:"Club",
            sub:"Choisis ton club.",
            render: () => this.renderSelect("club", "‚Äî S√©lectionne un club ‚Äî", ClubsProvider.list()),
            normalize: (v)=> String(v||"").trim(),
            preview: (v)=> v ? v : "‚Ä¶",
          },
          {
            key:"sexe",
            title:"Sexe",
            sub:"Choisis Masculin ou F√©minin.",
            render: () => this.renderSelect("sexe", "‚Äî S√©lectionne ‚Äî", ["Masculin","F√©minin"]),
            normalize: (v)=> String(v||"").trim(),
            preview: (v)=> v ? v : "‚Ä¶",
          }
        ];
      }

      init() {
        this.backBtn.addEventListener("click", () => this.go(this.current - 1, true));
        this.nextBtn.addEventListener("click", () => this.next());

        // allow tapping on already reached steps
        this.stepNodes.forEach(node => {
          node.addEventListener("click", () => {
            const i = Number(node.dataset.i);
            const max = this.maxReachableStep();
            if (i <= max) this.go(i, true);
          });
        });

        this.renderStep(this.current);
        this.refresh();
      }

      renderStep(i) {
        const step = this.steps[i];
        this.badge.textContent = String(i + 1);
        this.stepTitle.textContent = step.title;
        this.stepSub.textContent = step.sub;
        this.stage.innerHTML = "";
        step.render();
        this.refresh();
      }

      renderInput(key, placeholder, autocomplete) {
        this.stage.innerHTML = `
          <div class="field">
            <input id="field" placeholder="${this.esc(placeholder)}" autocomplete="${this.esc(autocomplete)}" />
            <div class="check" id="check">‚úì</div>
          </div>
        `;

        const input = document.getElementById("field");
        const check = document.getElementById("check");

        input.value = this.state[key] || "";

        const onInput = () => {
          const step = this.steps[this.current];
          const raw = input.value;
          const norm = step.normalize ? step.normalize(raw) : raw;
          if (norm !== raw) input.value = norm;
          this.state[key] = input.value;

          const ok = this.isFilled(input.value);
          input.classList.toggle("is-ok", ok);
          input.classList.toggle("is-empty", !ok);
          check.classList.toggle("show", ok);

          this.refresh();
        };

        input.addEventListener("input", onInput);
        onInput();

        setTimeout(() => {
          try { input.focus({ preventScroll:true }); } catch(e) { input.focus(); }
        }, 70);
      }

      renderSelect(key, firstLabel, options) {
        const opts = [
          `<option value="">${this.esc(firstLabel)}</option>`,
          ...options.map(o => `<option value="${this.esc(o)}">${this.esc(o)}</option>`)
        ].join("");

        this.stage.innerHTML = `
          <div class="field">
            <select id="field">${opts}</select>
            <div class="check" id="check">‚úì</div>
          </div>
        `;

        const select = document.getElementById("field");
        const check = document.getElementById("check");

        select.value = this.state[key] || "";

        const onChange = () => {
          const step = this.steps[this.current];
          this.state[key] = step.normalize ? step.normalize(select.value) : select.value;

          const ok = this.isFilled(select.value);
          select.classList.toggle("is-ok", ok);
          select.classList.toggle("is-empty", !ok);
          check.classList.toggle("show", ok);

          this.refresh();
        };

        select.addEventListener("change", onChange);
        select.addEventListener("input", onChange);

        onChange();

        setTimeout(() => {
          try { select.focus({ preventScroll:true }); } catch(e) { select.focus(); }
        }, 70);
      }

      next() {
        if (!this.isStepOk(this.current)) return;

        this.fieldArea.classList.add("hiding");

        setTimeout(() => {
          if (this.current < this.steps.length - 1) {
            this.current++;
            this.fieldArea.classList.remove("hiding");
            this.renderStep(this.current);
          } else {
            this.fieldArea.classList.remove("hiding");
            this.showQR();
          }
        }, 220);
      }

      go(i, animate) {
        i = Math.max(0, Math.min(this.steps.length - 1, i));
        const max = this.maxReachableStep();
        if (i > max) return;

        if (animate) {
          this.fieldArea.classList.add("hiding");
          setTimeout(() => {
            this.current = i;
            this.fieldArea.classList.remove("hiding");
            this.renderStep(this.current);
          }, 220);
        } else {
          this.current = i;
          this.renderStep(this.current);
        }
      }

      maxReachableStep() {
        for (let i = 0; i < this.steps.length; i++) {
          if (!this.isStepOk(i)) return i;
        }
        return this.steps.length - 1;
      }

      isFilled(v) { return String(v || "").trim().length > 0; }

      isStepOk(i) {
        const key = this.steps[i].key;
        return this.isFilled(this.state[key]);
      }

      refresh() {
        // status
        const ok = this.isStepOk(this.current);
        this.status.classList.toggle("ok", ok);
        this.statusTxt.textContent = ok ? "‚úì OK" : "Requis";

        // buttons
        this.backBtn.disabled = (this.current === 0);
        this.nextBtn.disabled = !ok;
        this.nextBtn.textContent = (this.current === this.steps.length - 1) ? "Terminer" : "Suivant";

        // previews in progress row
        this.preview[0].textContent = this.steps[0].preview(this.state.nom);
        this.preview[1].textContent = this.steps[1].preview(this.state.prenom);
        this.preview[2].textContent = this.steps[2].preview(this.state.club);
        this.preview[3].textContent = this.steps[3].preview(this.state.sexe);

        // step states
        this.stepNodes.forEach((node, i) => {
          node.classList.toggle("active", i === this.current);
          node.classList.toggle("done", this.isStepOk(i));
        });

        // progress bar
        const filled = this.steps.reduce((acc, _, i) => acc + (this.isStepOk(i) ? 1 : 0), 0);
        this.progressBar.style.width = `${Math.round((filled / this.steps.length) * 100)}%`;

        // QR visibility
        if (!this.isAllComplete()) this.hideQR();
      }

      isAllComplete() {
        return this.steps.every((_, i) => this.isStepOk(i));
      }

      buildPayload() {
        const n = (this.state.nom || "").trim();
        const p = (this.state.prenom || "").trim();
        const c = (this.state.club || "").trim();
        const s = (this.state.sexe || "").trim();
        return `${n};${p};${c};${s};`;
      }

      showQR() {
        if (!this.isAllComplete()) return;

        const payload = this.buildPayload();
        this.qr.src = QrService.url(payload, 560);

        this.qr.classList.remove("reveal");
        void this.qr.offsetWidth;
        this.qr.classList.add("reveal");

        this.spark.classList.remove("on");
        void this.spark.offsetWidth;
        this.spark.classList.add("on");

        this.qr.style.display = "block";
        this.empty.style.display = "none";

        this.hint.textContent = "Donn√©es encod√©es :";
        this.payloadBox.textContent = payload;
        this.payloadBox.style.display = "block";

        if (!this.playedSound) {
          this.playedSound = true;
          SoundService.playHajime();
        }
      }

      hideQR() {
        this.qr.style.display = "none";
        this.qr.classList.remove("reveal");
        this.empty.style.display = "block";
        this.hint.textContent = "";
        this.payloadBox.style.display = "none";
        this.playedSound = false;
      }

      esc(s){
        return String(s)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }
    }

    // iOS: voices can load async
    if ("speechSynthesis" in window) {
      window.speechSynthesis.getVoices?.();
      window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices?.();
    }

    new App().init();
  </script>
</body>
</html>